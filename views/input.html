<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AI Career Mapper - Input</title>
    <!-- Poppins Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        /* Purple Theme */
        --primary: #8e44ad;
        --primary-light: #9b59b6;
        --primary-dark: #732d91;
        --secondary: #6c3483;
        --accent: #a569bd;

        /* Background & Text */
        --background: #121212;
        --surface: #1e1e1e;
        --text: #e0e0e0;
        --gray-light: #444;
        --white: #ffffff;
        --shadow: rgba(0, 0, 0, 0.5);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background-color: var(--background);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background-image: radial-gradient(
          circle at 50% 50%,
          #2c2c2c,
          var(--background)
        );
      }

      .container {
        width: 100%;
        max-width: 900px;
        background: var(--surface);
        border-radius: 20px;
        box-shadow: 0 10px 30px var(--shadow);
        overflow: hidden;
        position: relative;
      }

      .header {
        padding: 25px 40px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: var(--white);
        text-align: center;
        position: relative;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
      }

      .header h1 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 16px;
        opacity: 0.9;
      }

      .progress-container {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.2);
        margin-top: 15px;
        border-radius: 10px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        width: 0;
        background: var(--white);
        transition: width 0.5s ease;
        border-radius: 10px;
      }

      .content {
        padding: 40px;
        max-height: 500px;
        overflow-y: auto;
        position: relative;
        scrollbar-width: thin;
        scrollbar-color: var(--accent) var(--surface);
      }
      .content::-webkit-scrollbar {
        width: 8px;
      }
      .content::-webkit-scrollbar-track {
        background: var(--surface);
      }
      .content::-webkit-scrollbar-thumb {
        background-color: var(--accent);
        border-radius: 4px;
      }

      .question-slide {
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
        width: 100%;
      }
      .question-slide.active {
        display: flex;
      }

      .question-title {
        font-size: 22px;
        margin-bottom: 25px;
        color: var(--primary-light);
      }

      .options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        width: 100%;
        margin: 0 auto;
      }

      .option-item {
        background: var(--surface);
        border: 2px solid var(--gray-light);
        border-radius: 12px;
        padding: 16px 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
        width: 220px;
        text-align: left;
        min-height: 60px;
      }

      .option-item:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
      }

      .option-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(142, 68, 173, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .option-item:hover::before {
        left: 100%;
      }

      .option-item.selected {
        background: rgba(142, 68, 173, 0.2);
        border-color: var(--primary);
      }

      .option-item.selected::after {
        content: "âœ“";
        position: absolute;
        right: 20px;
        color: var(--primary);
        font-weight: bold;
      }

      .text-input {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid var(--gray-light);
        border-radius: 12px;
        font-size: 16px;
        transition: all 0.3s ease;
        margin-bottom: 15px;
        background-color: var(--surface);
        color: var(--text);
      }

      .text-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
      }

      .checkbox-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        width: 100%;
        justify-content: center;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .checkbox-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: var(--primary);
      }

      .footer {
        display: flex;
        justify-content: space-between;
        padding: 20px 40px;
        border-top: 1px solid var(--gray-light);
        background-color: var(--surface);
      }

      .btn {
        padding: 12px 25px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      }

      .btn-secondary {
        background: var(--gray-light);
        color: var(--text);
      }
      .btn-secondary:hover {
        background: #555;
      }

      .btn-primary {
        background: var(--primary);
        color: var(--white);
      }
      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(142, 68, 173, 0.4);
      }
      .btn-primary:disabled {
        background: #6a1b9a;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .result-container {
        padding: 10px;
      }

      .result-title {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 20px;
        color: var(--primary-light);
        text-align: center;
      }

      .career-path {
        background: linear-gradient(
          135deg,
          rgba(142, 68, 173, 0.1) 0%,
          rgba(142, 68, 173, 0.15) 100%
        );
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 5px solid var(--accent);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .career-path:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(142, 68, 173, 0.3);
      }

      .career-title {
        font-size: 22px;
        font-weight: 600;
        color: var(--primary-light);
        margin-bottom: 10px;
      }

      .career-match {
        display: inline-block;
        padding: 5px 10px;
        background: var(--accent);
        color: var(--white);
        border-radius: 20px;
        font-size: 14px;
        margin-bottom: 15px;
      }

      .career-description {
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .career-skills {
        margin-top: 15px;
      }
      .career-skills h4 {
        margin-bottom: 10px;
        font-size: 16px;
        color: var(--primary-light);
      }
      .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .skill-item {
        background: var(--gray-light);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 14px;
      }

      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      .loading-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 5px solid rgba(142, 68, 173, 0.2);
        border-top: 5px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .range-slider {
        width: 100%;
        margin: 15px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      .range-slider-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
      }
      .range-slider input {
        width: 100%;
        accent-color: var(--accent);
        height: 5px;
        margin: 10px 0;
      }
      .range-marks {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        color: #bbb;
        font-size: 14px;
      }

      .ai-typing {
        position: relative;
        margin-bottom: 15px;
        font-style: italic;
        color: var(--primary-light);
        text-align: center;
      }
      .ai-thinking {
        display: flex;
        gap: 4px;
        margin-top: 4px;
        justify-content: center;
      }
      .ai-thinking-dot {
        width: 8px;
        height: 8px;
        background-color: var(--primary);
        border-radius: 50%;
        animation: pulsing 1.5s infinite;
      }
      .ai-thinking-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .ai-thinking-dot:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes pulsing {
        0%,
        100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
      }

      .error-message {
        color: #ff6b6b;
        text-align: center;
        margin-bottom: 15px;
        font-size: 14px;
      }

      @media (max-width: 600px) {
        .content {
          padding: 30px 20px;
          height: auto;
          max-height: 600px;
        }
        .footer {
          padding: 15px 20px;
        }
        .header {
          padding: 20px;
        }
        .question-title {
          font-size: 20px;
        }
        .options-container {
          gap: 10px;
        }
        .option-item {
          width: 100%;
          min-height: 50px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- HEADER -->
      <div class="header">
        <h1>AI Career Mapper - Input</h1>
        <p>Provide your details to get personalized career recommendations</p>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </div>

      <!-- CONTENT -->
      <div class="content" id="content">
        <div class="error-message" id="errorMessage"></div>

        <!-- Slide 1: Current Status -->
        <div class="question-slide active" id="question1">
          <h2 class="question-title">What is your current status?</h2>
          <div class="options-container">
            <div class="option-item" data-value="student">I'm a student</div>
            <div class="option-item" data-value="recent-graduate">
              I'm a recent graduate
            </div>
            <div class="option-item" data-value="employed">
              I'm currently employed
            </div>
            <div class="option-item" data-value="career-changer">
              I'm looking to change careers
            </div>
            <div class="option-item" data-value="returning">
              I'm returning to the workforce
            </div>
          </div>
        </div>

        <!-- Slide 2: Education Level -->
        <div class="question-slide" id="question2">
          <h2 class="question-title">
            What is your highest level of education?
          </h2>
          <div class="options-container">
            <div class="option-item" data-value="high-school">High School</div>
            <div class="option-item" data-value="certificate">
              Certificate/Diploma
            </div>
            <div class="option-item" data-value="associate">
              Associate Degree
            </div>
            <div class="option-item" data-value="bachelor">
              Bachelor's Degree
            </div>
            <div class="option-item" data-value="master">Master's Degree</div>
            <div class="option-item" data-value="phd">PhD or Doctorate</div>
          </div>
        </div>

        <!-- Slide 3: Field of Study/Work -->
        <div class="question-slide" id="question3">
          <h2 class="question-title">
            What is your primary field of study or work?
          </h2>
          <div class="options-container">
            <div class="option-item" data-value="technology">
              Technology & Computing
            </div>
            <div class="option-item" data-value="business">
              Business & Finance
            </div>
            <div class="option-item" data-value="healthcare">
              Healthcare & Medicine
            </div>
            <div class="option-item" data-value="arts">Arts & Humanities</div>
            <div class="option-item" data-value="engineering">Engineering</div>
            <div class="option-item" data-value="science">
              Science & Research
            </div>
            <div class="option-item" data-value="education">
              Education & Teaching
            </div>
            <div class="option-item" data-value="other">Other</div>
          </div>
        </div>

        <!-- Slide 4: Skills (Tech) -->
        <div class="question-slide" id="question4-tech">
          <h2 class="question-title">Which technical skills do you possess?</h2>
          <div class="checkbox-container">
            <div class="checkbox-item">
              <input type="checkbox" id="skill1" value="javascript" /><label
                for="skill1"
                >JavaScript</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill2" value="python" /><label
                for="skill2"
                >Python</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill3" value="java" /><label
                for="skill3"
                >Java</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill4" value="csharp" /><label
                for="skill4"
                >C#</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill5" value="html-css" /><label
                for="skill5"
                >HTML/CSS</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill6" value="sql" /><label
                for="skill6"
                >SQL</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill7" value="cloud" /><label
                for="skill7"
                >Cloud Services</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill8" value="data-analysis" /><label
                for="skill8"
                >Data Analysis</label
              >
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="skill9"
                value="machine-learning"
              /><label for="skill9">Machine Learning</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="skill10" value="devops" /><label
                for="skill10"
                >DevOps</label
              >
            </div>
          </div>
          <h3 style="margin-top: 20px; font-size: 18px">Any other skills?</h3>
          <input
            type="text"
            class="text-input"
            id="otherTechSkills"
            placeholder="Enter other technical skills (comma-separated)..."
          />
        </div>

        <!-- Slide 4: Skills (Business) -->
        <div class="question-slide" id="question4-business">
          <h2 class="question-title">Which business skills do you possess?</h2>
          <div class="checkbox-container">
            <div class="checkbox-item">
              <input type="checkbox" id="bskill1" value="accounting" /><label
                for="bskill1"
                >Accounting</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="bskill2" value="marketing" /><label
                for="bskill2"
                >Marketing</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="bskill3" value="sales" /><label
                for="bskill3"
                >Sales</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="bskill4" value="management" /><label
                for="bskill4"
                >Management</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="bskill5" value="finance" /><label
                for="bskill5"
                >Finance</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="bskill6" value="hr" /><label
                for="bskill6"
                >Human Resources</label
              >
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="bskill7"
                value="project-management"
              /><label for="bskill7">Project Management</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="bskill8"
                value="business-analysis"
              /><label for="bskill8">Business Analysis</label>
            </div>
          </div>
          <h3 style="margin-top: 20px; font-size: 18px">Any other skills?</h3>
          <input
            type="text"
            class="text-input"
            id="otherBusinessSkills"
            placeholder="Enter other business skills (comma-separated)..."
          />
        </div>

        <!-- Slide 4: Skills (Healthcare) -->
        <div class="question-slide" id="question4-healthcare">
          <h2 class="question-title">
            Which healthcare skills do you possess?
          </h2>
          <div class="checkbox-container">
            <div class="checkbox-item">
              <input type="checkbox" id="hskill1" value="patient-care" /><label
                for="hskill1"
                >Patient Care</label
              >
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="hskill2"
                value="medical-records"
              /><label for="hskill2">Medical Records</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="hskill3"
                value="clinical-research"
              /><label for="hskill3">Clinical Research</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="hskill4" value="diagnostics" /><label
                for="hskill4"
                >Diagnostics</label
              >
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="hskill5"
                value="medical-devices"
              /><label for="hskill5">Medical Devices</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="hskill6"
                value="healthcare-admin"
              /><label for="hskill6">Healthcare Admin</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="hskill7" value="pharmacy" /><label
                for="hskill7"
                >Pharmacy</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="hskill8" value="mental-health" /><label
                for="hskill8"
                >Mental Health</label
              >
            </div>
          </div>
          <h3 style="margin-top: 20px; font-size: 18px">Any other skills?</h3>
          <input
            type="text"
            class="text-input"
            id="otherHealthcareSkills"
            placeholder="Enter other healthcare skills (comma-separated)..."
          />
        </div>

        <!-- Slide 4: Skills (Other) -->
        <div class="question-slide" id="question4-other">
          <h2 class="question-title">
            What skills do you possess in your field?
          </h2>
          <input
            type="text"
            class="text-input"
            id="generalSkills"
            placeholder="Enter your key skills (comma-separated)..."
          />
          <h3 style="margin-top: 20px; font-size: 18px">
            Years of experience in your field:
          </h3>
          <div class="range-slider">
            <div class="range-slider-label">
              <span>Experience Level</span>
              <span id="experienceValue">5 years</span>
            </div>
            <input
              type="range"
              min="0"
              max="20"
              value="5"
              id="experienceSlider"
            />
            <div class="range-marks">
              <span>0</span><span>5</span><span>10</span><span>15</span
              ><span>20+</span>
            </div>
          </div>
        </div>

        <!-- Slide 5: Work Environment -->
        <div class="question-slide" id="question5">
          <h2 class="question-title">What work environment do you prefer?</h2>
          <div class="options-container">
            <div class="option-item" data-value="remote">Fully Remote</div>
            <div class="option-item" data-value="hybrid">
              Hybrid (Mix of Remote and Office)
            </div>
            <div class="option-item" data-value="office">Office-based</div>
            <div class="option-item" data-value="field">
              Field Work (Variable Locations)
            </div>
            <div class="option-item" data-value="flexible">
              Flexible Schedule
            </div>
          </div>
        </div>

        <!-- Slide 6: Work Values -->
        <div class="question-slide" id="question6">
          <h2 class="question-title">
            Which values are most important to you in a career?
          </h2>
          <div class="options-container">
            <div class="option-item" data-value="creativity">
              Creativity & Innovation
            </div>
            <div class="option-item" data-value="stability">
              Stability & Security
            </div>
            <div class="option-item" data-value="advancement">
              Growth & Advancement
            </div>
            <div class="option-item" data-value="purpose">
              Purpose & Social Impact
            </div>
            <div class="option-item" data-value="leadership">
              Leadership & Influence
            </div>
            <div class="option-item" data-value="work-life">
              Work-Life Balance
            </div>
            <div class="option-item" data-value="compensation">
              Compensation & Benefits
            </div>
          </div>
        </div>

        <!-- Slide 7: Career Goals -->
        <div class="question-slide" id="question7">
          <h2 class="question-title">What are your primary career goals?</h2>
          <div class="options-container">
            <div class="option-item" data-value="specialist">
              Become a specialist or expert
            </div>
            <div class="option-item" data-value="management">
              Move into management
            </div>
            <div class="option-item" data-value="entrepreneur">
              Start my own business
            </div>
            <div class="option-item" data-value="impact">
              Make a significant impact
            </div>
            <div class="option-item" data-value="financial">
              Achieve financial independence
            </div>
            <div class="option-item" data-value="learning">
              Continuous learning and growth
            </div>
          </div>
        </div>

        <!-- Slide 8: Strengths -->
        <div class="question-slide" id="question8">
          <h2 class="question-title">What are your greatest strengths?</h2>
          <div class="checkbox-container">
            <div class="checkbox-item">
              <input type="checkbox" id="strength1" value="analytical" /><label
                for="strength1"
                >Analytical Thinking</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="strength2" value="creative" /><label
                for="strength2"
                >Creativity</label
              >
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="strength3"
                value="communication"
              /><label for="strength3">Communication</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="strength4" value="leadership" /><label
                for="strength4"
                >Leadership</label
              >
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="strength5" value="teamwork" /><label
                for="strength5"
                >Teamwork</label
              >
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="strength6"
                value="problem-solving"
              /><label for="strength6">Problem Solving</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="strength7"
                value="detail-oriented"
              /><label for="strength7">Detail-Oriented</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="strength8"
                value="adaptability"
              /><label for="strength8">Adaptability</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="strength9"
                value="time-management"
              /><label for="strength9">Time Management</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="strength10" value="empathy" /><label
                for="strength10"
                >Empathy</label
              >
            </div>
          </div>
        </div>

        <!-- RESULTS -->
        <div class="question-slide" id="results">
          <div class="result-container">
            <h2 class="result-title">
              Your AI-Recommended Career Paths (Preview)
            </h2>
            <div class="ai-typing">
              <p>AI analyzing your profile and preferences...</p>
              <div class="ai-thinking">
                <div class="ai-thinking-dot"></div>
                <div class="ai-thinking-dot"></div>
                <div class="ai-thinking-dot"></div>
              </div>
            </div>
            <div id="careerResults">
              <!-- Career results dynamically inserted here -->
            </div>
            <p style="text-align: center; margin-top: 20px">
              This is a preview based on your input. Submit to save and view
              detailed recommendations!
            </p>
          </div>
        </div>

        <!-- LOADING OVERLAY -->
        <div class="loading-overlay" id="loadingOverlay">
          <div class="loading-spinner"></div>
          <p>Processing your data...</p>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="footer">
        <button class="btn btn-secondary" id="backBtn">Back</button>
        <button class="btn btn-primary" id="nextBtn">Next</button>
        <button class="btn btn-primary" id="dashboard-btn">
          Go to Dashboard
        </button>
        <button class="btn btn-primary" id="submitBtn" style="display: none">
          Submit
        </button>
      </div>
    </div>

    <script>
      const userData = {
        currentStatus: "",
        education: "",
        field: "",
        techSkills: [],
        otherTechSkills: "",
        businessSkills: [],
        otherBusinessSkills: "",
        healthcareSkills: [],
        otherHealthcareSkills: "",
        generalSkills: "",
        experienceYears: 5,
        workEnvironment: "",
        workValues: "",
        careerGoals: "",
        strengths: [],
      };

      let dynamicSkillSlideInserted = false;
      let selectedField = null;

      let slidesOrder = [
        "question1",
        "question2",
        "question3",
        "question5",
        "question6",
        "question7",
        "question8",
        "results",
      ];
      let currentSlideIndex = 0;

      const fieldToSkillSlide = {
        technology: "question4-tech",
        business: "question4-business",
        healthcare: "question4-healthcare",
        arts: "question4-other",
        engineering: "question4-other",
        science: "question4-other",
        education: "question4-other",
        other: "question4-other",
      };

      const progressBar = document.getElementById("progressBar");
      const nextBtn = document.getElementById("nextBtn");
      const backBtn = document.getElementById("backBtn");
      const submitBtn = document.getElementById("submitBtn");
      const dashboardBtn = document.getElementById("dashboard-btn");
      const loadingOverlay = document.getElementById("loadingOverlay");
      const content = document.getElementById("content");
      const errorMessage = document.getElementById("errorMessage");
      const experienceSlider = document.getElementById("experienceSlider");
      const experienceValue = document.getElementById("experienceValue");
      const allSlides = document.querySelectorAll(".question-slide");

      dashboardBtn.addEventListener("click", () => {
        console.log("Dashboard button clicked, redirecting to /dashboard");
        window.location.href = "/dashboard";
      });

      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        console.log("Token on load:", token);
        if (!token) {
          showError("Please log in to continue.");
          setTimeout(() => {
            console.log("Redirecting to /auth due to missing token");
            window.location.href = "/auth";
          }, 2000);
          return;
        }

        setupOptionClicks();
        setupCheckboxes();
        showSlide(slidesOrder[currentSlideIndex]);
        updateProgress();

        nextBtn.addEventListener("click", handleNext);
        backBtn.addEventListener("click", handleBack);
        experienceSlider.addEventListener("input", updateExperience);
        submitBtn.addEventListener("click", handleSubmit);
      });

      function showSlide(slideId) {
        allSlides.forEach((slide) => slide.classList.remove("active"));
        const targetSlide = document.getElementById(slideId);
        if (targetSlide) targetSlide.classList.add("active");
      }

      function updateProgress() {
        const totalSlides = slidesOrder.length;
        const progress = ((currentSlideIndex + 1) / totalSlides) * 100;
        progressBar.style.width = progress + "%";
      }

      function setupOptionClicks() {
        document.querySelectorAll(".option-item").forEach((item) => {
          item.addEventListener("click", function () {
            const container = this.parentElement;
            container
              .querySelectorAll(".option-item")
              .forEach((sib) => sib.classList.remove("selected"));
            this.classList.add("selected");
          });
        });
      }

      function setupCheckboxes() {}

      function handleNext() {
        if (!validateAndStoreData(slidesOrder[currentSlideIndex])) return;

        if (
          slidesOrder[currentSlideIndex] === "question3" &&
          !dynamicSkillSlideInserted
        ) {
          const skillSlideId =
            fieldToSkillSlide[selectedField] || "question4-other";
          slidesOrder.splice(3, 0, skillSlideId);
          dynamicSkillSlideInserted = true;
        }

        if (currentSlideIndex === slidesOrder.length - 2) {
          currentSlideIndex++;
          showSlide(slidesOrder[currentSlideIndex]);
          updateProgress();
          loadingOverlay.classList.add("active");
          setTimeout(() => {
            loadingOverlay.classList.remove("active");
            generateCareerMatches();
          }, 2000);
        } else if (currentSlideIndex < slidesOrder.length - 1) {
          currentSlideIndex++;
          showSlide(slidesOrder[currentSlideIndex]);
          updateProgress();
          toggleSubmitButton();
        }
      }

      function handleBack() {
        if (currentSlideIndex > 0) {
          currentSlideIndex--;
          showSlide(slidesOrder[currentSlideIndex]);
          updateProgress();
          toggleSubmitButton();
        }
      }

      function toggleSubmitButton() {
        submitBtn.style.display =
          currentSlideIndex === slidesOrder.length - 1 ? "block" : "none";
        nextBtn.style.display =
          currentSlideIndex === slidesOrder.length - 1 ? "none" : "block";
      }

      function updateExperience() {
        experienceValue.textContent = experienceSlider.value + " years";
        userData.experienceYears = parseInt(experienceSlider.value, 10);
      }

      function validateAndStoreData(slideId) {
        errorMessage.style.display = "none";
        switch (slideId) {
          case "question1":
            const status = getSelectedOption("question1");
            if (!status) {
              showError("Please select your current status.");
              return false;
            }
            userData.currentStatus = status;
            break;
          case "question2":
            const education = getSelectedOption("question2");
            if (!education) {
              showError("Please select your education level.");
              return false;
            }
            userData.education = education;
            break;
          case "question3":
            const field = getSelectedOption("question3");
            if (!field) {
              showError("Please select your field of study or work.");
              return false;
            }
            userData.field = field;
            selectedField = field;
            break;
          case "question4-tech":
            userData.techSkills = getCheckedValues([
              "#skill1",
              "#skill2",
              "#skill3",
              "#skill4",
              "#skill5",
              "#skill6",
              "#skill7",
              "#skill8",
              "#skill9",
              "#skill10",
            ]);
            userData.otherTechSkills = document
              .getElementById("otherTechSkills")
              .value.trim();
            break;
          case "question4-business":
            userData.businessSkills = getCheckedValues([
              "#bskill1",
              "#bskill2",
              "#bskill3",
              "#bskill4",
              "#bskill5",
              "#bskill6",
              "#bskill7",
              "#bskill8",
            ]);
            userData.otherBusinessSkills = document
              .getElementById("otherBusinessSkills")
              .value.trim();
            break;
          case "question4-healthcare":
            userData.healthcareSkills = getCheckedValues([
              "#hskill1",
              "#hskill2",
              "#hskill3",
              "#hskill4",
              "#hskill5",
              "#hskill6",
              "#hskill7",
              "#hskill8",
            ]);
            userData.otherHealthcareSkills = document
              .getElementById("otherHealthcareSkills")
              .value.trim();
            break;
          case "question4-other":
            userData.generalSkills = document
              .getElementById("generalSkills")
              .value.trim();
            break;
          case "question5":
            const workEnv = getSelectedOption("question5");
            if (!workEnv) {
              showError("Please select your preferred work environment.");
              return false;
            }
            userData.workEnvironment = workEnv;
            break;
          case "question6":
            const workValues = getSelectedOption("question6");
            if (!workValues) {
              showError("Please select a key career value.");
              return false;
            }
            userData.workValues = workValues;
            break;
          case "question7":
            const careerGoals = getSelectedOption("question7");
            if (!careerGoals) {
              showError("Please select a career goal.");
              return false;
            }
            userData.careerGoals = careerGoals;
            break;
          case "question8":
            userData.strengths = getCheckedValues([
              "#strength1",
              "#strength2",
              "#strength3",
              "#strength4",
              "#strength5",
              "#strength6",
              "#strength7",
              "#strength8",
              "#strength9",
              "#strength10",
            ]);
            break;
        }
        return true;
      }

      function getSelectedOption(slideId) {
        const slide = document.getElementById(slideId);
        return slide
          ? slide
              .querySelector(".option-item.selected")
              ?.getAttribute("data-value")
          : null;
      }

      function getCheckedValues(selectors) {
        return selectors
          .map((sel) => document.querySelector(sel))
          .filter((cb) => cb?.checked)
          .map((cb) => cb.value);
      }

      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
      }

      function generateCareerMatches() {
        const resultsContainer = document.getElementById("careerResults");
        resultsContainer.innerHTML = "";

        const careerDataset = [
          {
            title: "Software Engineer",
            field: "technology",
            keywords: [
              "javascript",
              "python",
              "java",
              "csharp",
              "html-css",
              "sql",
              "cloud",
              "devops",
            ],
            description: "Design and maintain software solutions.",
          },
          {
            title: "Data Scientist",
            field: "technology",
            keywords: ["python", "data-analysis", "machine-learning", "sql"],
            description: "Analyze data and build predictive models.",
          },
          {
            title: "Cloud Architect",
            field: "technology",
            keywords: ["cloud", "devops", "sql"],
            description: "Design cloud infrastructures.",
          },
          {
            title: "Project Manager",
            field: "business",
            keywords: ["project-management", "management", "business-analysis"],
            description: "Lead projects and teams.",
          },
          {
            title: "Financial Analyst",
            field: "business",
            keywords: ["accounting", "finance", "business-analysis"],
            description: "Analyze financial data.",
          },
          {
            title: "Nurse",
            field: "healthcare",
            keywords: ["patient-care", "medical-records", "diagnostics"],
            description: "Provide patient care.",
          },
          {
            title: "Clinical Researcher",
            field: "healthcare",
            keywords: ["clinical-research", "diagnostics", "medical-devices"],
            description: "Conduct medical research.",
          },
          {
            title: "Graphic Designer",
            field: "arts",
            keywords: ["creative", "design", "visual"],
            description: "Create visual content.",
          },
          {
            title: "Research Scientist",
            field: "science",
            keywords: ["analytical", "science", "research"],
            description: "Conduct scientific experiments.",
          },
          {
            title: "Teacher",
            field: "education",
            keywords: ["communication", "education", "leadership"],
            description: "Educate and mentor students.",
          },
        ];

        let matchedCareers = careerDataset.filter(
          (career) =>
            userData.field === career.field ||
            (userData.field === "other" &&
              ["arts", "science", "education"].includes(career.field))
        );

        if (matchedCareers.length === 0) matchedCareers = careerDataset;

        matchedCareers.forEach((career) => {
          let score = 0;
          let userSkills = [];
          if (userData.field === "technology")
            userSkills = [
              ...userData.techSkills,
              ...(userData.otherTechSkills
                ? userData.otherTechSkills.split(/\s*,\s*/).filter(Boolean)
                : []),
            ];
          else if (userData.field === "business")
            userSkills = [
              ...userData.businessSkills,
              ...(userData.otherBusinessSkills
                ? userData.otherBusinessSkills.split(/\s*,\s*/).filter(Boolean)
                : []),
            ];
          else if (userData.field === "healthcare")
            userSkills = [
              ...userData.healthcareSkills,
              ...(userData.otherHealthcareSkills
                ? userData.otherHealthcareSkills
                    .split(/\s*,\s*/)
                    .filter(Boolean)
                : []),
            ];
          else
            userSkills = userData.generalSkills
              ? userData.generalSkills.split(/\s*,\s*/).filter(Boolean)
              : [];
          userSkills.push(...userData.strengths);

          career.keywords.forEach(
            (kw) => (score += userSkills.includes(kw) ? 1 : 0)
          );
          career.score =
            score +
            (userData.workEnvironment === "remote" &&
            career.title.includes("Remote")
              ? 2
              : 0) +
            (userData.workValues === "compensation" &&
            career.title.includes("Analyst")
              ? 2
              : 0);
          career.matchPercent = Math.round(
            (career.score / (career.keywords.length + 4)) * 100
          );
        });

        matchedCareers.sort((a, b) => b.score - a.score);
        const topResults = matchedCareers.slice(0, 3);

        topResults.forEach((career) => {
          const pathDiv = document.createElement("div");
          pathDiv.classList.add("career-path");
          pathDiv.innerHTML = `
            <div class="career-title">${career.title}</div>
            <div class="career-match">${career.matchPercent}% Match</div>
            <div class="career-description">${career.description}</div>
            <div class="career-skills">
              <h4>Key Skills:</h4>
              <div class="skills-list">${career.keywords
                .map((skill) => `<span class="skill-item">${skill}</span>`)
                .join("")}</div>
            </div>
          `;
          resultsContainer.appendChild(pathDiv);
        });
      }

      async function handleSubmit() {
        if (!validateAndStoreData(slidesOrder[currentSlideIndex])) return;

        const token = localStorage.getItem("token");
        console.log("Token on submit:", token);
        if (!token) {
          showError("Please log in to submit your preferences.");
          setTimeout(() => {
            console.log("Redirecting to /auth due to missing token");
            window.location.href = "/auth";
          }, 2000);
          return;
        }

        loadingOverlay.classList.add("active");
        try {
          const submitData = { ...userData };
          console.log("Submitting data to /api/submit:", submitData);

          const response = await fetch("/api/submit", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(submitData),
          });

          console.log("Response status:", response.status);
          console.log("Response OK:", response.ok);
          const data = await response.json();
          console.log("Response data:", data);

          if (response.ok && data.success) {
            console.log("Submission successful, redirecting to /dashboard");
            localStorage.setItem("userData", JSON.stringify(submitData)); // Store for dashboard
            setTimeout(() => {
              window.location.href = "/dashboard";
            }, 1000);
          } else {
            showError(
              "Failed to save preferences: " + (data.error || "Unknown error")
            );
            console.error("Submission failed:", data.error);
          }
        } catch (error) {
          console.error("Submission error:", error);
          showError(
            "An error occurred during submission. Please try again later."
          );
        } finally {
          setTimeout(() => {
            loadingOverlay.classList.remove("active");
          }, 1000);
        }
      }
    </script>
  </body>
</html>
